
# –ü–ª–∞–Ω: –¢–æ—á–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–æ–¥—É–ª—è–º —Ç—Ä–µ–Ω–∏–Ω–≥–æ–≤

## –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–∏–∑ –ë–î)

### –ú–æ–¥—É–ª—å "–£—Ä–æ–∫–∏ –±–µ–∑ –º–æ–¥—É–ª–µ–π" (–í–æ–ø—Ä–æ—Å—ã –∏ –í–∏–¥–µ–æ–æ—Ç–≤–µ—Ç—ã)
- **module_id:** `8b1fb03e-8743-4654-a07f-b6c03ca7517b`
- **–î–æ—Å—Ç—É–ø –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è:**
  - **BUSINESS** (106 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫) ‚úÖ
  - **FULL** (22 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫) ‚úÖ
- **–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞:**
  - **CHAT** (20 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫) ‚ùå ‚Äî –ø–æ –≤–∞—à–∏–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –ù–ï –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞

### –°–≤–æ–¥–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

| –ì—Ä—É–ø–ø–∞ | –ö–æ–ª-–≤–æ | –í–∏–¥–∏—Ç –º–æ–¥—É–ª–∏? |
|--------|--------|---------------|
| –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã (super_admin + admin) | 5 | ‚úÖ –î–∞ |
| BUSINESS –ø–æ–¥–ø–∏—Å–∫–∞ | 106 | ‚úÖ –î–∞ |
| FULL –ø–æ–¥–ø–∏—Å–∫–∞ | 22 | ‚úÖ –î–∞ |
| CHAT –ø–æ–¥–ø–∏—Å–∫–∞ (–ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º) | 20 | ‚ùå –ù–µ—Ç |
| –¢–æ–ª—å–∫–æ entitlement `club` (–±–µ–∑ FULL/BUSINESS) | 24 | ‚ùì –í–æ–ø—Ä–æ—Å |
| CHAT + entitlement | 13 | ‚ùì –í–æ–ø—Ä–æ—Å |

## –í–æ–ø—Ä–æ—Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å `entitlement.product_code='club'` ‚Äî –¥–æ–ª–∂–Ω—ã –ª–∏ –æ–Ω–∏ –≤–∏–¥–µ—Ç—å –º–æ–¥—É–ª–∏?**

–¢–µ–∫—É—â–∏–π –∫–æ–¥ –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç entitlements, —Ç–æ–ª—å–∫–æ:
1. –†–æ–ª—å –∞–¥–º–∏–Ω–∞ ‚Üí –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
2. `subscriptions_v2.tariff_id` ‚Üí —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Å `module_access`

24 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–º–µ—é—Ç —Ç–æ–ª—å–∫–æ entitlement –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏ FULL/BUSINESS. –ï—Å–ª–∏ entitlement –¥–æ–ª–∂–µ–Ω –¥–∞–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø ‚Äî –∫–æ–¥ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å.

---

## –ü–ª–∞–Ω –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 1. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞

**–§–∞–π–ª:** `src/pages/LibraryModule.tsx`

–î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç—É–ø–∞ –∏ CTA-–∫–∞—Ä—Ç–æ—á–∫—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏:

```text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üîí –ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —É—á–∞—Å—Ç–Ω–∏–∫–∞–º    ‚îÇ
‚îÇ      —Ç–∞—Ä–∏—Ñ–æ–≤ FULL –∏ BUSINESS       ‚îÇ
‚îÇ                                    ‚îÇ
‚îÇ  –û—Ñ–æ—Ä–º–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å ‚îÇ
‚îÇ  –¥–æ—Å—Ç—É–ø –∫ –≤–∏–¥–µ–æ–æ—Ç–≤–µ—Ç–∞–º –∏ –≤–æ–ø—Ä–æ—Å–∞–º  ‚îÇ
‚îÇ                                    ‚îÇ
‚îÇ     [ –£–∑–Ω–∞—Ç—å –æ –ö–ª—É–±–µ ]             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

–õ–æ–≥–∏–∫–∞:
- –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ `useTrainingModules` (—Ö—É–∫ —É–∂–µ –≤—ã—á–∏—Å–ª—è–µ—Ç `has_access`)
- –ï—Å–ª–∏ `has_access = false`, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º CTA –≤–º–µ—Å—Ç–æ —Å–ø–∏—Å–∫–∞ —É—Ä–æ–∫–æ–≤

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ Kinescope –ø–ª–µ–µ—Ä–∞

**–§–∞–π–ª:** `src/hooks/useKinescopePlayer.ts`

–ü—Ä–æ–±–ª–µ–º–∞: `MutationObserver` –∏ `setTimeout` –≤—ã–∑—ã–≤–∞—é—Ç `forceFill()` –ø–æ—Å–ª–µ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `isMounted` –≤–æ –≤—Å–µ callback'–∏:

```tsx
// –°—Ç—Ä–æ–∫–∏ 293-295: –æ–±–µ—Ä–Ω—É—Ç—å setTimeout
setTimeout(() => { if (isMounted) forceFill(); }, 100);
setTimeout(() => { if (isMounted) forceFill(); }, 300);
setTimeout(() => { if (isMounted) forceFill(); }, 500);

// –°—Ç—Ä–æ–∫–∞ 300: –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ MutationObserver
observer = new MutationObserver(() => {
  if (!isMounted) return;
  throttledForceFill();
});
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ entitlements (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å `entitlement.product_code='club'` –î–û–õ–ñ–ù–´ –≤–∏–¥–µ—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç, –¥–æ–±–∞–≤–∏—Ç—å –≤ `useTrainingModules.tsx`:

```tsx
// –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ subscriptions_v2
let hasClubEntitlement = false;
if (user) {
  const { data: entData } = await supabase
    .from("entitlements")
    .select("id")
    .eq("user_id", user.id)
    .eq("product_code", "club")
    .eq("status", "active")
    .limit(1);
  
  hasClubEntitlement = (entData?.length ?? 0) > 0;
}

// –ò–∑–º–µ–Ω–∏—Ç—å —É—Å–ª–æ–≤–∏–µ hasAccess (—Å—Ç—Ä–æ–∫–∞ 116)
const hasAccess = isAdminUser || 
  hasClubEntitlement ||  // ‚Üê –ù–û–í–û–ï
  moduleAccess.length === 0 || 
  moduleAccess.some(a => userTariffIds.includes(a.tariff_id));
```

---

## –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. `src/pages/LibraryModule.tsx` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å CTA –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞
2. `src/hooks/useKinescopePlayer.ts` ‚Äî –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É removeChild
3. `src/hooks/useTrainingModules.tsx` ‚Äî (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ) –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É entitlements

---

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

- **CHAT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (20):** –≤–∏–¥—è—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ "–ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è FULL/BUSINESS"
- **FULL/BUSINESS –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (128):** –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –º–æ–¥—É–ª—è–º
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã (5):** –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Ä–æ–∫–∞ –Ω–µ "–ø–∞–¥–∞–µ—Ç" –ø–æ—Å–ª–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∏–¥–µ–æ
