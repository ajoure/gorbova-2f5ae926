
# –ü–ª–∞–Ω: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ —Å –±–æ—Ç–æ–º –û–ª–µ–≥–æ–º + –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### –§–∞–∑–∞ 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ç–∞–π–º–∞—É—Ç –∞–Ω–∞–ª–∏–∑–∞
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∞ –º–æ–¥–µ–ª—å –Ω–∞ `google/gemini-2.5-flash`
- –£–º–µ–Ω—å—à–µ–Ω `BATCH_SIZE_FOR_AI` –¥–æ 500

### –§–∞–∑–∞ 2: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç-–ø–∞–∫–µ—Ç `audience_insights`
- –°–æ–∑–¥–∞–Ω –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞
- –°–æ–¥–µ—Ä–∂–∏—Ç: –±–æ–ª–∏, –∏–Ω—Ç–µ—Ä–µ—Å—ã, –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è, –≤–æ–ø—Ä–æ—Å—ã, –ø—Ä–æ–±–ª–µ–º—ã

### –§–∞–∑–∞ 3: –†–∞—Å—à–∏—Ä–µ–Ω generateAudienceInsightsPrompt
- **–î–û–ë–ê–í–õ–ï–ù–û:** –ö–∞—Ä—Ç–∞ –±–æ–ª–µ–π (üî¥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ, üü† —É–º–µ—Ä–µ–Ω–Ω—ã–µ, üü¢ –º–∏–Ω–æ—Ä–Ω—ã–µ)
- **–î–û–ë–ê–í–õ–ï–ù–û:** –ö–æ–Ω—Ç–µ–Ω—Ç-–∏–¥–µ–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–ø–∏–∫–æ–≤ –∏ –≤–æ–ø—Ä–æ—Å–æ–≤

### –§–∞–∑–∞ 4: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–æ—Ç—É –û–ª–µ–≥—É
- `audience_insights` –∞–≤—Ç–æ-–≤–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä–∏ `sales_enabled`
- **–î–û–ë–ê–í–õ–ï–ù–û:** –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `style_profile` –∏–∑ `telegram_publish_channels`
- –°—Ç–∏–ª—å –ö–∞—Ç–µ—Ä–∏–Ω—ã —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç

### –§–∞–∑–∞ 5: Cron-–∑–∞–¥–∞—á–∞
- –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ 03:00 UTC –µ–∂–µ–¥–Ω–µ–≤–Ω–æ

### –§–∞–∑–∞ 6: UI –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ "–°–≤—è–∑—å —Å –û–ª–µ–≥–æ–º" –≤ AdminMarketingInsights

### –§–∞–∑–∞ 7: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥ tool_call_id (07.02.2026)
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ followup-–∑–∞–ø—Ä–æ—Å–µ –∫ AI –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è tool, —Å–æ–æ–±—â–µ–Ω–∏—è —Å `role: 'tool'` –Ω–µ —Å–æ–¥–µ—Ä–∂–∞–ª–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—è `tool_call_id`, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –æ—à–∏–±–∫–µ 400 –∏ —Å–æ–æ–±—â–µ–Ω–∏—é "–ü—Ä–æ–∏–∑–æ—à–ª–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞".

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –ë–´–õ–û:
aiMessages.push({ role: 'tool', content: toolResults[i] });

// –°–¢–ê–õ–û:
aiMessages.push({
  role: 'tool',
  tool_call_id: tr.id,  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è OpenAI-compatible API
  content: tr.content,
});
```

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|-----------|------|-----------|
| Edge Function | `analyze-audience/index.ts` | +–∫–∞—Ä—Ç–∞ –±–æ–ª–µ–π, +–∫–æ–Ω—Ç–µ–Ω—Ç-–∏–¥–µ–∏ |
| Edge Function | `telegram-ai-support/index.ts` | +tool_call_id, +style_profile, +error logging |
| UI | `AdminMarketingInsights.tsx` | +–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–≤—è–∑–∏ —Å –±–æ—Ç–æ–º |

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏ (DoD)

| –ü—Ä–æ–≤–µ—Ä–∫–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|-----------|
| –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è | ‚úÖ –ù–µ—Ç shutdown |
| –ü–∞–∫–µ—Ç `audience_insights` | ‚úÖ –°–æ–∑–¥–∞–Ω —Å –∫–∞—Ä—Ç–æ–π –±–æ–ª–µ–π –∏ –∫–æ–Ω—Ç–µ–Ω—Ç-–∏–¥–µ—è–º–∏ |
| –ë–æ—Ç –û–ª–µ–≥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω—Å–∞–π—Ç—ã | ‚úÖ –í —Ä–µ–∂–∏–º–µ –ø—Ä–æ–¥–∞–∂ |
| –ë–æ—Ç –û–ª–µ–≥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∏–ª—å | ‚úÖ style_profile –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è |
| Tool calls —Ä–∞–±–æ—Ç–∞—é—Ç | ‚úÖ –ù–µ—Ç –æ—à–∏–±–∫–∏ "–ü—Ä–æ–∏–∑–æ—à–ª–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞" |
| Cron job | ‚úÖ `audience-analysis-nightly` –∞–∫—Ç–∏–≤–Ω–∞ |
| UI | ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–≤—è–∑–∏ |
