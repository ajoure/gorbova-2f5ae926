# ÐŸÐ»Ð°Ð½: Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ ÑƒÑ€Ð¾ÐºÐ°Ð¼Ð¸ Ð² Ð‘Ð°Ð·Ðµ Ð·Ð½Ð°Ð½Ð¸Ð¹ + ÐœÐ¾Ð½ÐµÑ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð°

## Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: Ð¤Ð°Ð·Ð° 1 â€” âœ… Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾

### Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð±Ð°Ð³Ð¸ Ð¼Ð°ÑÑ‚ÐµÑ€Ð°:
1. âœ… Ð¡ÐºÑ€Ð¾Ð»Ð» Ð´Ð»Ñ ÑÐ¿Ð¸ÑÐºÐ° Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð² â€” Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ `max-h-[300px] overflow-y-auto`
2. âœ… Placeholder Ñ‚Ð°Ð¹Ð¼ÐºÐ¾Ð´Ð° Ð¸Ð·Ð¼ÐµÐ½Ñ‘Ð½ Ð½Ð° `Ñ‡Ñ‡:Ð¼Ð¼:ÑÑ`
3. âœ… ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº ÑˆÐ°Ð³Ð¾Ð² Ð¸Ð·Ð¼ÐµÐ½Ñ‘Ð½: **Ð”Ð¾ÑÑ‚ÑƒÐ¿ â†’ Ð£Ñ€Ð¾Ðº** (Ð²Ð¼ÐµÑÑ‚Ð¾ Ð£Ñ€Ð¾Ðº â†’ Ð”Ð¾ÑÑ‚ÑƒÐ¿)
4. âœ… Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑƒÑ€Ð¾ÐºÐ° Ð¾Ñ‚Ð»Ð¾Ð¶ÐµÐ½Ð¾ Ð´Ð¾ Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ ÑˆÐ°Ð³Ð° â€” Ð½Ð¸ÐºÐ°ÐºÐ¸Ñ… Ð¼ÑƒÑÐ¾Ñ€Ð½Ñ‹Ñ… Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð¿Ñ€Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ð¸ Ð¼Ð°ÑÑ‚ÐµÑ€Ð°
5. âœ… ÐœÐ°ÑÑ‚ÐµÑ€ Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð´Ð»Ñ `knowledge-videos` Ð˜ `knowledge-questions`

---

## Ð¤Ð°Ð·Ð° 2: ÐœÐ¾Ð½ÐµÑ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð° (ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ ÑÐ¿Ñ€Ð¸Ð½Ñ‚)

### ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°: Ð£Ð½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Ñ†ÐµÐ½

**ÐšÐ¾Ð½Ñ†ÐµÐ¿Ñ†Ð¸Ñ:** ÐÐµ Ð¿Ñ€Ð¸Ð²ÑÐ·Ñ‹Ð²Ð°ÐµÐ¼ÑÑ Ðº ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð¼Ñƒ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ñƒ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Club). ÐœÐ¾Ð¶Ð½Ð¾ Ð·Ð°Ð´Ð°Ñ‚ÑŒ Ñ†ÐµÐ½Ñƒ Ð´Ð»Ñ Ð›Ð®Ð‘ÐžÐ“Ðž Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð°/Ñ‚Ð°Ñ€Ð¸Ñ„Ð°.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ÐŸÐ ÐÐ’Ð˜Ð›Ð Ð¦Ð•Ð Ð”Ð›Ð¯ Ð£Ð ÐžÐšÐ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜‘ï¸ ÐŸÑ€Ð¾Ð´Ð°Ð²Ð°Ñ‚ÑŒ ÑÑ‚Ð¾Ñ‚ ÑƒÑ€Ð¾Ðº Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾                                  â”‚
â”‚                                                                 â”‚
â”‚ Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ Ñ†ÐµÐ½Ð° (Ð´Ð»Ñ Ð²ÑÐµÑ… Ð±ÐµÐ· Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ¸): [300] BYN                 â”‚
â”‚                                                                 â”‚
â”‚ âž• Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð¾ Ñ†ÐµÐ½Ñ‹:                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚: [Gorbow Club â–¼]                                 â”‚  â”‚
â”‚   â”‚ Ð¢Ð°Ñ€Ð¸Ñ„:   [CHAT â–¼]                                        â”‚  â”‚
â”‚   â”‚ Ð¦ÐµÐ½Ð°:    [100] BYN                                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚: [Gorbow Club â–¼]                                 â”‚  â”‚
â”‚   â”‚ Ð¢Ð°Ñ€Ð¸Ñ„:   [FULL â–¼]                                        â”‚  â”‚
â”‚   â”‚ Ð¦ÐµÐ½Ð°:    [50] BYN                                        â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚: [ÐšÑƒÑ€Ñ "Ð‘ÑƒÑ…Ð³Ð°Ð»Ñ‚ÐµÑ€Ð¸Ñ ÐºÐ°Ðº Ð±Ð¸Ð·Ð½ÐµÑ" â–¼]               â”‚  â”‚
â”‚   â”‚ Ð¢Ð°Ñ€Ð¸Ñ„:   [Ð›ÑŽÐ±Ð¾Ð¹ Ñ‚Ð°Ñ€Ð¸Ñ„ â–¼]                                 â”‚  â”‚
â”‚   â”‚ Ð¦ÐµÐ½Ð°:    [75] BYN                                        â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚ Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°:                                           â”‚
â”‚   â—‹ ÐÐ°Ð²ÑÐµÐ³Ð´Ð°                                                    â”‚
â”‚   â—‹ ÐÐ° [ N ] Ð´Ð½ÐµÐ¹                                               â”‚
â”‚   â—‹ Ð”Ð¾ ÐºÐ¾Ð½Ñ†Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð° Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ¸                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…

```typescript
interface LessonSaleConfig {
  enabled: boolean;              // ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°Ñ‚ÐµÐ»ÑŒ "ÐŸÑ€Ð¾Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾"
  basePrice: number;             // Ð¦ÐµÐ½Ð° Ð´Ð»Ñ Ð²ÑÐµÑ… Ð±ÐµÐ· Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ¸
  
  accessDuration: 'forever' | 'days' | 'period';
  accessDays?: number;           // Ð•ÑÐ»Ð¸ 'days'
  
  priceRules: {                  // Ð£Ð½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Ð¿Ð¾ Ð»ÑŽÐ±Ñ‹Ð¼ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð°Ð¼/Ñ‚Ð°Ñ€Ð¸Ñ„Ð°Ð¼
    productId: string;           // UUID Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð° (Ð¸Ð»Ð¸ '*' Ð´Ð»Ñ Ð»ÑŽÐ±Ð¾Ð³Ð¾)
    tariffId: string;            // UUID Ñ‚Ð°Ñ€Ð¸Ñ„Ð° (Ð¸Ð»Ð¸ '*' Ð´Ð»Ñ Ð»ÑŽÐ±Ð¾Ð³Ð¾ Ñ‚Ð°Ñ€Ð¸Ñ„Ð° Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð°)
    price: number;               // Ð¦ÐµÐ½Ð° Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ Ñ‚Ð°Ñ€Ð¸Ñ„Ð°
  }[];
  
  // ÐžÐ¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ Ð´Ð»Ñ Ð¿Ð¾Ð»Ð½Ð¾Ñ†ÐµÐ½Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð°
  productName?: string;          // ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ (Ð°Ð²Ñ‚Ð¾Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¸Ð· Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ ÑƒÑ€Ð¾ÐºÐ°)
  productSlug?: string;          // Slug (Ð°Ð²Ñ‚Ð¾Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ)
  createFullProduct?: boolean;   // Ð¡Ð¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾Ð»Ð½Ð¾Ñ†ÐµÐ½Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚ Ñ Ð»ÐµÐ½Ð´Ð¸Ð½Ð³Ð¾Ð¼
}
```

### Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…

**ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ 1: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ product_id Ð² training_lessons**
```sql
ALTER TABLE training_lessons 
  ADD COLUMN IF NOT EXISTS product_id uuid REFERENCES products_v2(id);

CREATE INDEX IF NOT EXISTS idx_training_lessons_product_id 
  ON training_lessons(product_id);
```

**ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ 2: Ð Ð°ÑÑˆÐ¸Ñ€Ð¸Ñ‚ÑŒ RLS lesson_blocks**
```sql
-- Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ entitlement/subscription Ð½Ð° product_id ÑƒÑ€Ð¾ÐºÐ°
CREATE POLICY "Access via lesson product" ON lesson_blocks FOR SELECT
USING (
  EXISTS (
    SELECT 1 FROM training_lessons tl
    JOIN products_v2 p ON p.id = tl.product_id
    JOIN entitlements e ON e.product_code = p.code
    WHERE tl.id = lesson_blocks.lesson_id
      AND tl.product_id IS NOT NULL
      AND e.user_id = auth.uid()
      AND e.status = 'active'
  )
);
```

### Ð›Ð¾Ð³Ð¸ÐºÐ° Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ Ñ†ÐµÐ½Ñ‹ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ

```typescript
// Ð¥ÑƒÐº useLessonPrice(lessonId, userId)
async function getLessonPriceForUser(lessonId: string, userId: string) {
  // 1. ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ product_id ÑƒÑ€Ð¾ÐºÐ° Ð¸ ÐµÐ³Ð¾ offers
  const lesson = await getLesson(lessonId);
  if (!lesson.product_id) return null; // Ð£Ñ€Ð¾Ðº Ð½Ðµ Ð¿Ñ€Ð¾Ð´Ð°Ñ‘Ñ‚ÑÑ
  
  const offers = await getOffersForProduct(lesson.product_id);
  
  // 2. ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ðµ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¿Ð¾ Ð’Ð¡Ð•Ðœ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð°Ð¼
  const userSubscriptions = await getUserActiveSubscriptions(userId);
  
  // 3. ÐÐ°Ð¹Ñ‚Ð¸ offer Ñ Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ñ†ÐµÐ½Ð¾Ð¹, ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐµ
  let bestOffer = offers.find(o => o.is_primary); // Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ Ñ†ÐµÐ½Ð°
  
  for (const sub of userSubscriptions) {
    const matchingOffer = offers.find(o => 
      o.meta?.for_existing_tariff_id === sub.tariff_id
    );
    if (matchingOffer && matchingOffer.amount < bestOffer.amount) {
      bestOffer = matchingOffer;
    }
  }
  
  return bestOffer;
}
```

### Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð° Ð¿Ñ€Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ð¸ Ð¼Ð°ÑÑ‚ÐµÑ€Ð°

```typescript
// ÐŸÑ€Ð¸ wizardData.saleConfig.enabled === true
async function createLessonProduct(lessonId: string, saleConfig: LessonSaleConfig) {
  // 1. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚
  const productCode = `lesson-${lessonSlug}`;
  const { data: newProduct } = await supabase
    .from("products_v2")
    .insert({
      code: productCode,
      name: saleConfig.productName || `Ð£Ñ€Ð¾Ðº: ${lessonTitle}`,
      category: 'lesson',
      status: 'active',
      is_active: true,
      currency: 'BYN',
    })
    .select()
    .single();
  
  // 2. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ‚Ð°Ñ€Ð¸Ñ„ Ñ Ð´Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒÑŽ
  const accessDays = saleConfig.accessDuration === 'forever' 
    ? 36500  // ~100 Ð»ÐµÑ‚
    : (saleConfig.accessDays || 30);
  
  const { data: newTariff } = await supabase
    .from("tariffs")
    .insert({
      product_id: newProduct.id,
      code: `${productCode}-base`,
      name: 'Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ðº ÑƒÑ€Ð¾ÐºÑƒ',
      access_days: accessDays,
      is_active: true,
    })
    .select()
    .single();
  
  // 3. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ â€” Ð±Ð°Ð·Ð¾Ð²Ð°Ñ Ñ†ÐµÐ½Ð°
  await supabase.from("tariff_offers").insert({
    tariff_id: newTariff.id,
    offer_type: 'pay_now',
    button_label: 'ÐšÑƒÐ¿Ð¸Ñ‚ÑŒ',
    amount: saleConfig.basePrice,
    is_active: true,
    is_primary: true,
    sort_order: 0,
  });
  
  // 4. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð´Ð¾Ð¿. ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Ñ†ÐµÐ½Ñ‹
  for (const rule of saleConfig.priceRules) {
    await supabase.from("tariff_offers").insert({
      tariff_id: newTariff.id,
      offer_type: 'pay_now',
      button_label: `Ð¡Ð¿ÐµÑ†Ð¸Ð°Ð»ÑŒÐ½Ð°Ñ Ñ†ÐµÐ½Ð°`,
      amount: rule.price,
      is_active: true,
      is_primary: false,
      sort_order: 1,
      meta: { 
        for_existing_product_id: rule.productId,
        for_existing_tariff_id: rule.tariffId 
      },
    });
  }
  
  // 5. ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑƒÑ€Ð¾Ðº Ñ product_id
  await supabase
    .from("training_lessons")
    .update({ product_id: newProduct.id })
    .eq("id", lessonId);
}
```

### UI ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹

1. **LessonSaleConfig.tsx** â€” Ñ„Ð¾Ñ€Ð¼Ð° Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸ Ð² Ð¼Ð°ÑÑ‚ÐµÑ€Ðµ:
   - ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°Ñ‚ÐµÐ»ÑŒ "ÐŸÑ€Ð¾Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾"
   - Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ Ñ†ÐµÐ½Ð°
   - Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¿Ñ€Ð°Ð²Ð¸Ð» Ñ†ÐµÐ½ (Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚ â†’ Ñ‚Ð°Ñ€Ð¸Ñ„ â†’ Ñ†ÐµÐ½Ð°)
   - Ð’Ñ‹Ð±Ð¾Ñ€ Ð´Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°

2. **LessonPurchaseButton.tsx** â€” ÐºÐ½Ð¾Ð¿ÐºÐ° Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸ Ð² ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐµ ÑƒÑ€Ð¾ÐºÐ°:
   - ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½ÑƒÑŽ Ñ†ÐµÐ½Ñƒ
   - ÐžÑ‚ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ PaymentDialog Ñ product_id ÑƒÑ€Ð¾ÐºÐ°

3. **RestrictedLessonBanner.tsx** â€” Ð±Ð°Ð½Ð½ÐµÑ€ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð±ÐµÐ· Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°:
   - ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð¿Ñ€ÐµÐ²ÑŒÑŽ ÑƒÑ€Ð¾ÐºÐ°
   - Ð¦ÐµÐ½Ð° Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ° Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸

---

## Ð¤Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ

| Ð¤Ð°Ð¹Ð» | Ð¡Ñ‚Ð°Ñ‚ÑƒÑ | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ |
|------|--------|----------|
| `ContentCreationWizard.tsx` | âœ… Done | ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº ÑˆÐ°Ð³Ð¾Ð², Ð°Ñ‚Ð¾Ð¼Ð°Ñ€Ð½Ð¾Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ |
| `KbLessonFormFields.tsx` | âœ… Done | Ð¡ÐºÑ€Ð¾Ð»Ð» Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð², sticky header |
| `KbQuestionInput.tsx` | âœ… Done | Placeholder Ñ‚Ð°Ð¹Ð¼ÐºÐ¾Ð´Ð° `Ñ‡Ñ‡:Ð¼Ð¼:ÑÑ` |
| **ÐÐžÐ’Ð«Ð™** `LessonSaleConfig.tsx` | ðŸ”œ Todo | UI ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸ |
| **ÐÐžÐ’Ð«Ð™** `LessonPurchaseButton.tsx` | ðŸ”œ Todo | ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸ |
| **ÐœÐ˜Ð“Ð ÐÐ¦Ð˜Ð¯** | ðŸ”œ Todo | product_id + RLS |
| `useLessonPrice.tsx` | ðŸ”œ Todo | Ð¥ÑƒÐº Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ Ñ†ÐµÐ½Ñ‹ |

---

## Ð Ð°Ð½ÐµÐµ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð¾ (Ð¤Ð°Ð·Ð° 0)

### Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° ÑƒÑ€Ð¾ÐºÐ¾Ð²
- âœ… Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½ Ð¿Ð¾Ñ€ÑÐ´Ð¾Ðº ORDER BY: `sort_order DESC` ÐºÐ°Ðº Ð¿ÐµÑ€Ð²Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡
- âœ… Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ UI-Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°Ñ‚ÐµÐ»ÑŒ "Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð½Ð¾Ð²Ñ‹Ðµ / Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° ÑÑ‚Ð°Ñ€Ñ‹Ðµ"

### Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ Ð² Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ°Ñ…
- âœ… ÐšÐ½Ð¾Ð¿ÐºÐ° "Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ" ÑÐ´ÐµÐ»Ð°Ð½Ð° Ñ€Ð°Ð±Ð¾Ñ‡ÐµÐ¹

### ÐœÐ°ÑÑ‚ÐµÑ€ Ð´Ð»Ñ Ð‘Ð°Ð·Ñ‹ Ð·Ð½Ð°Ð½Ð¸Ð¹
- âœ… Ð¡Ð¾Ð·Ð´Ð°Ð½ `KbLessonFormFields.tsx`
- âœ… Ð¡Ð¾Ð·Ð´Ð°Ð½ `KbQuestionInput.tsx`
- âœ… ÐœÐ¾Ð´Ð¸Ñ„Ð¸Ñ†Ð¸Ñ€Ð¾Ð²Ð°Ð½ `ContentCreationWizard.tsx` Ð´Ð»Ñ KB
- âœ… ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ video block + kb_questions
